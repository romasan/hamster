{"version":3,"sources":["src/helpers.ts","src/animatedLink.ts","src/ws.ts","src/online.ts","src/index.ts"],"names":[],"mappings":"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","file":"src.6627ffd3.js","sourceRoot":"..","sourcesContent":["export const render = (callback, start?, frame?) => {\n\tif (!start) {\n\t\tstart = Date.now()\n\t}\n\n\tif (!frame) {\n\t\tframe = 0\n\t}\n\n\tif (callback(Date.now() - start, ++frame)) {\n\t\trequestAnimationFrame(() => render(callback, start, frame))\n\t}\n};\n\nexport const pick = (source, keys: string[]) =>\n\tkeys.reduce(\n\t\t(obj, key) => ({\n\t\t\t...obj,\n\t\t\t[key]: source[key],\n\t\t}),\n\t\t{}\n\t);\n\nexport const calcAge = (birthday) => new Date(Date.now() - birthday).getUTCFullYear() - 1970;\n\nexport const debounce = (callback: () => void, delay?: number, timer?: number) => (...args) => {\n\tclearTimeout(timer);\n\ttimer = setTimeout(() => callback(...args), delay || 100);\n};\n\nconst events = {};\n\nexport const on = (event, callback) => {\n\tevents[event] = [...(events[event] || []), callback]\n};\n\nexport const emit = (event, payload) => {\n\tevents[event]?.forEach((callback) => callback(payload))\n};\n","import { render, pick } from './helpers'\n\nconst STEP = 80;\n\nexport const animatedLink = (link, gurgle?) => {\n\tconst canvas = document.querySelector('#canvas') as HTMLElement;\n\tconst rects = link.getClientRects()[0];\n\tconst el = document.createElement('div');\n\n\tcanvas.appendChild(el);\n\n\tif (gurgle) {\n\t\tlocalStorage.setItem('link', Date.now());\n\t\tdocument.location = link.href;\n\t}\n\n\tel.classList.add(gurgle ? 'link-cover-second' : 'link-cover');\n\tsetTimeout(() => {\n\t\tel.remove();\n\t}, 2000);\n\tObject.entries(pick(rects, ['left', 'top', 'width', 'height']))\n\t\t.forEach(\n\t\t\t([key, value]) => (el.style[key] = `${Math.ceil(Number(key === 'top' ? value + canvas.scrollTop : value))}px`)\n\t\t);\n\tconst margins = [screen.height, screen.width];\n\tconst margin = Math.max(...margins);\n\tconst stepWidth = STEP;\n\tconst steps = Math.ceil(margin / stepWidth);\n\tconst sleep = 1;\n\tconst width = el.style.width;\n\tconst height = el.style.height;\n\n\tlet step = 0;\n\tlet prev = 0;\n\tlet counter = 0;\n\n\trender((time, _step) => {\n\t\tif (prev === 0) {\n\t\t\tprev = time;\n\t\t}\n\n\t\tcounter += time - prev;\n\n\t\tif (counter > sleep) {\n\t\t\tcounter = 0;\n\t\t\tstep += 1;\n\t\t}\n\n\t\tconst padding = step * stepWidth;\n\n\t\tel.style.transform = `translate(-${padding}px, -${padding}px)`;\n\t\tel.style.width = `${parseInt(width) + padding * 2}px`;\n\t\tel.style.height = `${parseInt(height) + padding * 2}px`;\n\n\t\tif (step >= steps - 1) {\n\t\t\tif (!gurgle) {\n\t\t\t\tanimatedLink(link, true);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t});\n};\n","import { emit } from './helpers'\n\nconst ws = new WebSocket('wss://node.nbauer.ru:9000');\n\nexport const send = (event, payload) => {\n\tif (ws.readyState === 1) {\n\t\tws.send(JSON.stringify({ event, payload }));\n\t}\n};\n\nlet timer = null\n\nws.onopen = () => {\n\ttimer = setInterval(() => {\n\t\tws.send(2);\n\t}, 1000)\n};\n\nws.onmessage = ({ data }) => {\n\ttry {\n\t\tconst { event, payload } = JSON.parse(data);\n\n\t\tif (event) {\n\t\t\temit(event, payload);\n\t\t}\n\t} catch (e) {\n\t\tconsole.log('Error: parse json', e);\n\t}\n};\n\nws.onclose = () => {\n\tclearInterval(timer);\n}\n","import { on, render } from './helpers';\nimport { send } from './ws';\n\nconst state = {\n\tdots: {},\n};\n\non('init', ({ user, users }) => {\n\tstate.user = user\n\tstate.users = users\n});\n\non('add', (user) => {\n\tstate.users = {\n\t\t...state.users,\n\t\t[user.id]: user,\n\t}\n});\n\non('leave', (id) => {\n\tdelete state.users[id]\n});\n\nconst pushPos = ({ clientX, clientY }) => {\n\tsend('move', { x: clientX, y: clientY })\n};\n\nwindow.addEventListener('mousemove', pushPos);\n\non('move', user => {\n\tstate.users[user.id] = user\n});\n\nconst canvas = document.querySelector('#background');\n\nrender(() => {\n\tif (state.users) {\n\t\tObject.entries(state.users).forEach(([id, user]) => {\n\t\t\tif (user.id !== state.user.id && user.position) {\n\t\t\t\tif (!state.dots[id]) {\n\t\t\t\t\tconst dot = document.createElement('div')\n\t\t\t\t\tdot.classList.add('dot')\n\t\t\t\t\tcanvas?.appendChild(dot)\n\t\t\t\t\tstate.dots[id] = dot\n\t\t\t\t}\n\n\t\t\t\tstate.dots[id].style.top = `${user.position.y}px`\n\t\t\t\tstate.dots[id].style.left = `${user.position.x}px`\n\t\t\t}\n\t\t})\n\n\t\tObject.entries(state.dots).forEach(([id, dot]) => {\n\t\t\tif (!state.users[id]) {\n\t\t\t\tdot.remove()\n\t\t\t\tdelete state.dots[id]\n\t\t\t}\n\t\t})\n\t}\n\n\treturn true;\n});\n","import { render, calcAge } from './helpers';\nimport { animatedLink } from './animatedLink';\nimport { Ani, Track } from './types';\nimport './online';\n\nconst animations: Ani[] = [\n\t{\n\t\tname: 'fake preload',\n\t\tduration: 1500,\n\t\tinit() {\n\t\t\treturn {\n\t\t\t\tpattern: '/—\\\\|',\n\t\t\t\tsleep: 500,\n\t\t\t};\n\t\t},\n\t\trender(canvas, cursor, payload) {\n\t\t\tconst index = parseInt(String(((cursor!.msAtStart % payload.sleep) * payload.pattern.length) / payload.sleep));\n\n\t\t\tcanvas!.innerText = payload.pattern[index];\n\t\t},\n\t\tfinish(canvas, payload, name) {\n\t\t\tcanvas!.innerText = '';\n\t\t},\n\t},\n\t{\n\t\tname: 'type text',\n\t\tduration: 2000,\n\t\tinit() {\n\t\t\tconst age = calcAge(new Date('06/05/1990'));\n\t\t\tconst text = `Hello, my name is Roman, I'm ${age} and I'm a programmer`;\n\n\t\t\treturn {\n\t\t\t\ttext,\n\t\t\t\tsleep: 600,\n\t\t\t};\n\t\t},\n\t\trender(canvas, cursor, payload) {\n\t\t\tconst index = parseInt(String(((cursor!.msAtStart % payload.sleep) * 2) / payload.sleep));\n\t\t\tconst text = payload.text.slice(0, (payload.text.length / 100) * cursor!.percent);\n\n\t\t\tcanvas!.innerHTML = `\n\t\t\t\t<div class=\"cursor-space\">\n\t\t\t\t\t${text}<span class=\"cursor\" style=\"display: ${index ? 'none' : 'block'}\">|</span>\n\t\t\t\t<div>\n\t\t\t`;\n\t\t},\n\t\tfinish(canvas, payload) {\n\t\t\tcanvas!.innerText = payload.text;\n\t\t},\n\t},\n\t{\n\t\tname: 'sleep',\n\t\tduration: 500,\n\t},\n\t{\n\t\tname: 'type menu',\n\t\tduration: 4000,\n\t\tinit(canvas, name) {\n\t\t\tconst menu = [\n\t\t\t\t{\n\t\t\t\t\tlink: '/projects/',\n\t\t\t\t\tlabel: 'my projects',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlink: 'https://www.github.com/romasan',\n\t\t\t\t\tlabel: 'github',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlink: 'https://www.linkedin.com/in/roman-bauer',\n\t\t\t\t\tlabel: 'linkedin',\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tconst rawHTML = `\n\t\t\t\t<div>\n\t\t\t\t\t${menu\n\t\t\t\t\t\t.map(\n\t\t\t\t\t\t\t(item, index) => `\n\t\t\t\t\t\t<a href=\"${item.link}\" data-index=\"${index}\">[${item.label}]</a>\n\t\t\t\t\t`\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.join(' ')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tconst el = document.createElement('div');\n\t\t\tel.innerHTML = rawHTML;\n\t\t\tconst text = el.innerText;\n\t\t\tel.innerText = '';\n\t\t\tcanvas?.appendChild(el);\n\n\t\t\treturn {\n\t\t\t\trawHTML,\n\t\t\t\ttext,\n\t\t\t\tmenu,\n\t\t\t\tsleep: 600,\n\t\t\t\tcanvas: el,\n\t\t\t};\n\t\t},\n\t\trender(canvas, cursor, payload) {\n\t\t\tconst index = parseInt(String(((cursor!.msAtStart % payload.sleep) * 2) / payload.sleep));\n\t\t\tconst text = payload.text.slice(0, (payload.text.length / 100) * cursor!.percent);\n\n\t\t\tpayload.canvas!.innerHTML = `\n\t\t\t\t<div class=\"cursor-space\">\n\t\t\t\t\t${text}<span class=\"cursor\" style=\"display: ${index ? 'block' : 'none'}\">|</span>\n\t\t\t\t<div>\n\t\t\t`;\n\t\t},\n\t\tfinish(canvas, payload) {\n\t\t\tpayload.canvas!.innerHTML = payload.rawHTML;\n\t\t\tconst elements = payload.canvas.querySelectorAll('a[data-index]');\n\n\t\t\telements.forEach((link) => {\n\t\t\t\tlink.addEventListener('click', (event) => {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tanimatedLink(event.target);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t},\n];\n\nconst getCursor = (time, frame, item) => {\n\tconst msAtStart = time - item.startTime;\n\tconst percent = msAtStart / (item.duration / 100);\n\n\treturn {\n\t\tmsAtStart,\n\t\tglobalMs: time,\n\t\tglobalFrame: frame,\n\t\tpercent,\n\t\tendTime: item.endTime,\n\t\tduration: item.duration,\n\t};\n};\n\nconst rewind = (canvas, list: Track[]) => {\n\tlist.forEach((item, index) => {\n\t\titem.payload = item?.init?.(canvas, item.name, list[index - 1]);\n\t\titem.inited = true;\n\n\t\tconst cursor = getCursor(item.endTime, 0, item);\n\t\titem?.render?.(canvas, cursor, item.payload, item.name);\n\n\t\titem?.finish?.(canvas, item.payload, item.name);\n\t\titem.cleared = true;\n\t})\n};\n\nconst play = (canvas, list) => {\n\trender((time, frame) => {\n\t\tlist.forEach((item, index) => {\n\t\t\tif (time < item.startTime) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (time <= item.endTime) {\n\t\t\t\tif (item.inited) {\n\t\t\t\t\tconst cursor = getCursor(time, frame, item);\n\t\t\t\t\titem?.render?.(canvas, cursor, item.payload, item.name);\n\t\t\t\t} else {\n\t\t\t\t\titem.payload = item?.init?.(canvas, item.name, list[index - 1]);\n\t\t\t\t\titem.inited = true;\n\t\t\t\t}\n\t\t\t} else if (!item.cleared) {\n\t\t\t\titem?.finish?.(canvas, item.payload, item.name);\n\t\t\t\titem.cleared = true;\n\t\t\t}\n\t\t});\n\n\t\tif (list[list.length - 1].endTime < time) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t})\n};\n\nconst main = () => {\n\tlet timer = 0;\n\tconst list: Track[] = animations.map((animation) => ({\n\t\t...animation,\n\t\tinited: false,\n\t\tcleared: false,\n\t\tstartTime: timer,\n\t\tendTime: (timer += animation.duration),\n\t\tpayload: null,\n\t}));\n\n\tconst canvas = document.querySelector('#canvas') as HTMLElement;\n\n\tconst returned = Number(localStorage.getItem('link'));\n\n\tif (returned && Date.now() - returned < 1000 * 60 * 60) {\n\t\trewind(canvas, list);\n\t} else {\n\t\tplay(canvas, list);\n\t}\n\n\tconst dot = document.createElement('a');\n\n\tdot.classList.add('pinkDot');\n\tdot.href = 'https://romasan.github.io/www.803c.ru/about/';\n\tdocument.body.appendChild(dot);\n};\n\ndocument.addEventListener('DOMContentLoaded', main);\n"]}