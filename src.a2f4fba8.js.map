{"version":3,"sources":["src/index.ts"],"names":[],"mappings":"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","file":"src.a2f4fba8.js","sourceRoot":"..","sourcesContent":["interface Cursor {\n  msAtStart: number\n  globalMs: number\n  globalFrame: number\n  percent: number\n  endTime: number\n  duration: number\n}\n\ninterface Ani {\n  name?: string\n  duration: number\n  init?: (canvas: HTMLElement | null, name?: string, prev?: any) => any\n  render?: (canvas: HTMLElement | null, cursor?: Cursor, payload?: any, name?: string) => void\n  finish?: (canvas: HTMLElement | null, payload?: any, name?: string) => void\n}\n\nconst render = (callback, start?, frame?) => {\n  if (!start) {\n      start = Date.now();\n  }\n  if (!frame) {\n    frame = 0\n  }\n  if (callback(Date.now() - start, ++frame)) {\n      requestAnimationFrame(() => render(callback, start, frame));\n  }\n}\n\nconst pick = (obj, keys) => keys.reduce((o, key) => ({...o, [key]: obj[key]}), {})\n\nconst animatedLink = (link, gurgle?) => {\n  const rects = link.getClientRects()[0]\n  const el = document.createElement('div')\n  document.body.appendChild(el)\n  el.classList.add(gurgle ? 'link-cover-second' : 'link-cover')\n  Object.entries(pick(rects, ['left', 'top', 'width', 'height'])).forEach(([key, value]) => el.style[key] = `${Math.ceil(Number(value))}px`)\n  const margins = Object.entries(\n    pick(rects, ['left', 'right', 'top', 'bottom'])\n  )\n  .map(([key, value]) => value) as number[]\n  const margin = Math.max(...margins)\n  const stepWidth = 40\n  const steps = Math.ceil(margin / stepWidth)\n  const sleep = 1\n  const width = el.style.width\n  const height = el.style.height\n\n  let step = 0\n  let prev = 0\n  let counter = 0\n\n  render((time, _step) => {\n    if (prev === 0) {\n      prev = time\n    }\n    counter += (time - prev)\n    if (counter > sleep) {\n      counter = 0\n      step += 1\n    }\n    const padding = step * stepWidth\n    console.log('====', { padding, step, _step}, width, height)\n    el.style.transform = `translate(-${padding}px, -${padding}px)`\n    el.style.width = `${parseInt(width) + padding * 2}px`\n    el.style.height = `${parseInt(height) + padding * 2}px`\n    if (step >= steps - 1) {\n      if (gurgle) {\n        document.location = link.href\n      } else {\n        animatedLink(link, true)\n      }\n      return false\n    }\n    return true\n  })\n}\n\nconst animations: Ani[] = [\n  {\n    name: 'fake preload',\n    duration: 1500,\n    init() {\n      return {\n        pattern: '/â€”\\\\|',\n        sleep: 500,\n      }\n    },\n    render(canvas, cursor, payload) {\n      const index = parseInt(String(cursor!.msAtStart % payload.sleep * payload.pattern.length / payload.sleep));\n      canvas!.innerText = payload.pattern[index];\n    },\n    finish(canvas, payload, name) {\n      canvas!.innerText = ''\n    },\n  },\n  {\n    name: 'type text',\n    duration: 2000,\n    init() {\n      const [birthday, birthmonth, birthyear] = [5, 6, 1990]\n      const [year, month, day] = ['getFullYear', 'getMonth', 'getDate'].map(e => new Date()[e]())\n      const full = (month === birthmonth - 1 && day >= birthday) || month >= birthmonth\n      const age = year - birthyear - Number(!full)\n      const text = `Hello, my name is Roman, I'm ${age} and I'm a programmer`\n      return {\n        text,\n        sleep: 600,\n      }\n    },\n    render(canvas, cursor, payload) {\n      const index = parseInt(String(cursor!.msAtStart % payload.sleep * 2 / payload.sleep));\n      const text = payload.text.slice(0, payload.text.length / 100 * cursor!.percent)\n      canvas!.innerHTML = `\n        <div class=\"cursor-space\">\n          ${text}<span style=\"visibility: ${index ? 'hidden' : 'visible'}\">|</span>\n        <div>\n      `\n    },\n    finish(canvas, payload) {\n      canvas!.innerText = payload.text\n    },\n  },\n  {\n    name: 'sleep',\n    duration: 500,\n  },\n  {\n    name: 'type menu',\n    duration: 4000,\n    init(canvas, name) {\n      const menu = [\n        {\n          link: '/projects/',\n          label: 'my projects'\n        },\n        {\n          link: 'https://www.github.com/romasan',\n          label: 'github'\n        },\n        {\n          link: 'https://www.linkedin.com/in/roman-bauer',\n          label: 'linkedin'\n        }\n      ]\n\n      const rawHTML = `\n        <div>\n          ${menu.map((item, index) => `\n            <a href=\"${item.link}\" data-index=\"${index}\">[${item.label}]</a>\n          `).join(' ')}\n        </div>\n      `\n      const el = document.createElement('div')\n      el.innerHTML = rawHTML\n      const text = el.innerText\n      el.innerText = ''\n      canvas?.appendChild(el)\n\n      return {\n        rawHTML,\n        text,\n        menu,\n        sleep: 600,\n        canvas: el,\n      }\n    },\n    render(canvas, cursor, payload) {\n      const index = parseInt(String(cursor!.msAtStart % payload.sleep * 2 / payload.sleep));\n      const text = payload.text.slice(0, payload.text.length / 100 * cursor!.percent)\n      payload.canvas!.innerHTML = `\n        <div class=\"cursor-space\">\n          ${text}<span class=\"cursor\" style=\"display: ${index ? 'block' : 'none'}\">|</span>\n        <div>\n      `\n    },\n    finish(canvas, payload) {\n      payload.canvas!.innerHTML = payload.rawHTML\n      const elements = payload.canvas.querySelectorAll('a[data-index]')\n      elements.forEach((link) => {\n        link.addEventListener('click', (event) => {\n          event.preventDefault()\n          animatedLink(event.target)\n        })\n      })\n    },\n  }\n]\n\nconst main = () => {\n  let timer = 0\n  const list = animations.map(animation => ({\n    ...animation,\n    inited: false,\n    cleared: false,\n    startTime: timer,\n    endTime: timer += animation.duration,\n    payload: null,\n  }))\n\n  const canvas = document.querySelector('#canvas') as HTMLElement;\n\n  render(\n    (time, frame) => {\n      list.forEach((item, index) => {\n        if (time >= item.startTime) {\n          if (time <= item.endTime) {\n            if (item.inited) {\n              const msAtStart = time - item.startTime\n              const percent = msAtStart / (item.duration / 100)\n              const cursor = {\n                msAtStart,\n                globalMs: time,\n                globalFrame: frame,\n                percent,\n                endTime: item.endTime,\n                duration: item.duration,\n              }\n              item?.render?.(canvas, cursor, item.payload, item.name)\n            } else {\n              item.payload = item?.init?.(canvas, item.name, list[index - 1])\n              item.inited = true\n            }\n          } else if (!item.cleared) {\n            item?.finish?.(canvas, item.payload, item.name)\n            item.cleared = true\n          }\n        }\n      })\n      if (list[list.length - 1].endTime < time) {\n        return false\n      }\n      return true;\n    },\n  )\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", main);\n"]}